- hosts: webservers
  user: ec2-user
  sudo: yes

  tasks:

    ##
    # Apache2 install.
    #
    - name: Apache | Install
      action: apt name=$item
      with_items:
        - apache2
    - name: Apache | Start service
      action: service name=httpd state=started

    ##
    # Apache2 setup.
    #
    - name: Apache | Enable some required modules
      action: command a2enmod rewrite vhost_alias
      tags: common

    - name: Apache | Configuration file for our site
      action: template src=templates/etc-apache2-sites-available-server.j2 dest=/etc/apache2/sites-available/server
      tags: common

    - name: Apache | Disable the default site
      action: command a2dissite default
      tags: common

    - name: Apache | Enable our new site
      action: command a2ensite server
      tags: common
